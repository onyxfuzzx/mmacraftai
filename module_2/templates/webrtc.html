{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4><i class="bi bi-play-btn"></i> WebRTC Live Stream</h4>
            </div>
            <div class="card-body">
                <div class="text-center position-relative">
                    <video id="video" autoplay playsinline class="img-fluid rounded"></video>
                    <div id="feedback" class="feedback-badge alert alert-info">Waiting for connection...</div>
                </div>
                <div class="text-center mt-3">
                    <button id="startButton" class="btn btn-success btn-lg">
                        <i class="bi bi-play-circle"></i> Start Training
                    </button>
                    <button id="stopButton" class="btn btn-danger btn-lg" disabled>
                        <i class="bi bi-stop-circle"></i> Stop
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h4><i class="bi bi-speedometer2"></i> Live Metrics</h4>
            </div>
            <div class="card-body">
                <div id="stats-container">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Total Punches:</span>
                        <span id="total-punches" class="fw-bold">0</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Accuracy:</span>
                        <span id="accuracy" class="fw-bold">0%</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Guard Warnings:</span>
                        <span id="guard-warnings" class="fw-bold">0</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Session Time:</span>
                        <span id="session-time" class="fw-bold">0s</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Punches/Min:</span>
                        <span id="punch-rate" class="fw-bold">0</span>
                    </div>
                    <hr>
                    <h6><i class="bi bi-bar-chart"></i> Punch Breakdown</h6>
                    <div class="d-flex justify-content-between mb-1">
                        <span>Jab:</span>
                        <span id="jab-count">0</span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>Cross:</span>
                        <span id="cross-count">0</span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>Hook:</span>
                        <span id="hook-count">0</span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span>Uppercut:</span>
                        <span id="uppercut-count">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-body text-center">
                <a href="/end_session" class="btn btn-danger btn-lg w-100">
                    <i class="bi bi-flag"></i> End Session
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/webrtc.js') }}"></script>
<script>
    const sessionId = "{{ session_id }}";
    const iceServers = {{ ice_servers | tojson }};
</script>
{% endblock %}